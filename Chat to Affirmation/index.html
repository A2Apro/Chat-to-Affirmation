<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affirmation Agent</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        input, button { display: block; width: 100%; margin: 10px 0; padding: 10px; }
        #output { 
            margin-top: 20px; 
            padding: 15px; 
            background: #f0f0f0; 
            border-radius: 5px; 
            min-height: 50px; 
            white-space: pre-wrap; /* Ensures the AI text formats nicely */
        }
    </style>
</head>
<body>
    <h1>Affirmation Generator</h1>
    
    <label>What's on your mind?</label>
    <input type="text" id="topic" placeholder="e.g., Job anxiety, Feeling lost">
    
    <label>Your Belief System?</label>
    <input type="text" id="belief" placeholder="e.g., Christian, Buddhist, Scientific, General Spiritual">
    
    <button id="generateBtn">Get Affirmation</button>
    
    <div id="output">Your affirmation will appear here...</div>

    <script>
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const topic = document.getElementById('topic').value;
            const belief = document.getElementById('belief').value;
            const outputBox = document.getElementById('output');
            
            // Show loading state
            outputBox.innerText = "Generating...";
            
            try {
                /* UPDATE: Added './' before '.netlify'. 
                   This tells the browser to look inside the 'Chat to Affirmation' folder 
                   instead of the website root.
                */
                const response = await fetch('./.netlify/functions/agent', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic, belief })
                });

                if (!response.ok) {
                    // This will catch 404 (Not Found) or 500 (Server Error)
                    throw new Error(`Server Error: ${response.status}`);
                }

                const data = await response.json();
                
                // Display the affirmation sent back by your agent.js
                outputBox.innerText = data.affirmation;

            } catch (error) {
                console.error("Error details:", error);
                outputBox.innerText = "Error: " + error.message + ". Check the browser console and Netlify function logs.";
            }
        });
    </script>
</body>
</html>